---
title: "TUTORIAL 2 -Customized training database"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TUTORIAL_2_-_Customized_training_database}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
#system.file("extdata", package = "ResNatSeed")
load("~/Pacchetti R/ResNatSeed/inst/extdata/veg.composition.example.RData")
library(tidyr)
```

```{r setup}
library(ResNatSeed)
```


When the training database containing the vegetation surveys has not be the default one (relating to the Piedmont Region, Italy) but has to be one based on surveys of another geographical area, a specific training database must be generated through the *trainingDB* function before using the *RestInd* function.

In order to be processed with the *trainingDB* function, the vegetation database must be structured as follows (Table 1):

* The rows of the dataframe are characterised by the SURVEYS, while the columns report the abundances of the species
* The first column reports the survey code
* The second, third and fourth columns report the following site topographical information, e.g. calculated in a GIS environment or determined in the field:
  * **Elevation** expressed in meters above sea level (m a.s.l.)
  * **Slope** expressed in degrees (°)
  * **Aspect** expressed in degrees from North (°N) as it will be converted to "southness" to avoid circular variable issues in the models run with RestInd (Chang et al., 2004)
* From the fifth column onwards, the names of plant species follow. Plant species names do not necessarily have to be coded, they can be left in full. Afterwards, abbreviation codes will be automatically created in CEP names format: an abbreviation of species names according to the Cornell Ecology Programs (CEP), which uses eight-letter abbreviations for species. The CEP names code will be the one to consider when formulating the mixture/donor grassland.

Table 1. Example of the input database structure for the function *trainingDB*. This database includes 703 vegetation surveys and 532 plant species
```{r echo=FALSE}

veg.composition.example[1:6,1:8]
```

At this point, the customised training database can be generated by specifying the name of the vegetation database in the *data* argument of the **trainingDB** function. 
Through this function it is possible to refine the selection of species through two other arguments: **spe.freq** and **min.spe.abundance**. With these arguments it is possible to select only those species that appear a minimum number of times to allow statistical modelling (**spe.freq**). It is also possible to set an abundance threshold above which such statistical modelling **min.spe.abundance** can be considered. For example, if the abundances/coverages of occasionally occurring species are reported, these can be excluded from modelling.

* **spe.freq**: minimum frequency (equal or greater than) of species occurrence within the training database. It is advisable to set values greater than/equal to 30 to allow appropriate modelling.

* **min.spe.abundance**: value of abundance (greater than) beyond which species will be modelled. When NULL the parameter is set to 0.


```{r}
training.custom<-trainingDB(data=veg.composition.example,
           spe.freq = 30,# only species occurring at least in 30 surveys will be retained
           min.spe.abundance = 1# only species occurring at least 5% of relative abundance will be retained
           )

```

Through **trainingDB**, two dataframes are created and placed in an object (list) named in this example as 'training.custom'. The two dataframes are:

* **1 - cep.names**: database with the list of species suitable for modeling and their species codes (CEP names) to be used for the mixture/donor grassland composition. In this example 65 species (out of 532) are elegible for modelling 

```{r}
training.custom$cep.names
```


* **2 - trainingDB.ResNatSeed**: database to use in the 'RestInd' function

```{r}
head(training.custom$trainingDB.ResNatSeed)
```

From the list of species in 'training.custom$cep.names', it is necessary to create a database containing the mixture/donor grassland composition. The database consists of two columns:

* First column: species code abbreviated in CEP names format
* Second column: abundance of the species. Abundance can be expressed as a percentage

In this example, the mixture/donor grassland composition is characterised by four species: 

* Dactylis glomerata (CEP name: Dactglom), abundance: 25%
* Festuca ovina aggr. (CEP name: Festaggr), abundance: 35%
* Thymus serpyllum aggr. (CEP name: Thymaggr), abundance: 15%
* Lotus corniculatus (CEP name: Lotucorn), abundance: 8%

Total abundances amount to 83%. The total abundance of the mixture/donor grassland composition does not necessarily have to be 100%. 

We therefore create the database of the mixture/donor grassland composition:

```{r}
donor.composition<-data.frame(
  species=c("Dactglom","Festaggr","Thymaggr","Lotucorn"),
  abundance=c(25,35,15,8)
)

donor.composition
```


It is now possible to use the *RestInd* function to calculate the Mixture Suitability Index (MSI) and Mixture Reliability Index (MRI) of the donor grassland composition (dataframe 'donor.composition') at a site with the following topographical characteristics:

* elevation: 1600 m above sea level
* slope: 10°
* aspect: 110° N

Remember that in the 'trainingDB' argument it must be specified the one created above, i.e. training.custom$trainingDB.ResNatSeed

```{r echo=TRUE}
RestInd(trainingDB = training.custom$trainingDB.ResNatSeed, 
        composition=donor.composition,  
        elevation=1600, 
        slope=10, 
        aspect=110
        )
```
  


# References

* Chang, C., P. Lee, M. Bai, and T. Lin. 2004. Predicting the geographical distribution of plant communities in complex terrain–a case study in Fushian Experimental Forest, north- eastern Taiwan. Ecography. 27:577–588. doi:10.1111/j.0906- 7590.2004.03852.x

